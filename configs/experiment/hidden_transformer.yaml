# @package _global_
defaults:
  - override /submodule: [preprocess, dataset, model, train, predict, analysis, visualize]
  - _self_

hydra:
  # The sweeper params will be used only when MULTIRUN mode is used.
  # Uses the submodule parameters if in RUN mode.
  mode: MULTIRUN
  sweeper:
    params:
      submodule.model.hidden_size: 16, 32, 48, 64, 96, 128, 256, 512, 1024, 2048, 4096, 8192

submodule:
  # Generate train and validation dataset from scratch
  dataset:
    experimental_datasets:
      # Sines0000: all
      # Lorenz0000: all
      # VanDerPol0000: all
      Kato2015: all
      Nichols2017: all
      Skora2018: all
      Uzel2022: all
      Yemini2021: all
      Kaplan2020: all
      Flavell2023: all
      Leifer2023: all

    use_these_datasets:
      path: null
      num_worms: null

    save_datasets: false
    num_named_neurons: null
    num_train_samples: 32
    num_val_samples: 16
    seq_len: 200
    reverse: false
    use_residual: false
    smooth_data: true

  # Train model from scratch
  model:
    type: NeuralTransformer
    input_size: 302
    loss: MSE
    fft_reg_param: 0.0
    l1_reg_param: 0.0
    use_this_pretrained_model: null

  train:
    optimizer: AdamW
    lr: 0.0001
    epochs: 300
    save_freq: 100
    batch_size: 64
    shuffle: true
    early_stopping:
      # Minimum change in validation loss to be considered an improvement
      delta: 0
      # Number of epochs to wait for improvement before stopping
      patience: 50

  # Choose the worms that you want to predict
  predict:
    experimental_datasets:
      # Sines0000: worm0
      # Lorenz0000: worm0
      # VanDerPol0000: worm0
      Kato2015: worm0
      Nichols2017: worm0
      Skora2018: worm0
      Uzel2022: worm0
      Kaplan2020: worm0
      Flavell2023: worm0
      Leifer2023: worm0
    # Number of time steps to generate
    nb_ts_to_generate: null
    context_window: 200

  analysis:
    analyse_this_log_dir: null
    # Validate using all worms of each experimental datasets
    validation:
      experimental_datasets:
        # Sines0000: worm0
        # Lorenz0000: worm0
        # VanDerPol0000: worm0
        Kato2015: worm0
        Nichols2017: worm0
        Skora2018: worm0
        Uzel2022: worm0
        Kaplan2020: worm0
        Flavell2023: worm0
        Leifer2023: worm0

  visualize:
    plot_figures_from_this_log_dir: null
    predict:
      worms_to_plot: null # plot all predicted worms
      neurons_to_plot: null # plot all predicted neurons


experiment:
  name: hidden_transformer
  mode: MULTIRUN
  seed: null