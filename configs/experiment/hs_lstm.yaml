# @package _global_
defaults:
  - override /submodule: [dataset, model, train, predict, visualize]
  - override /hydra/sweeper: optuna # Use optuna for hyperparameter optimization
  - _self_

hydra:
  mode: MULTIRUN
  sweeper:
    sampler:
      seed: 42 # Seed for reproducibility
    study_name: hs_lstm # Name of the study (for optuna)
    direction: minimize # Minimize the metric
    n_trials: 10 # Number of trials to run
    n_jobs: 2 # Number of jobs to run in parallel
    params:
      # Hyperparameters to optimize
      submodule.train.optimizer: Adam, AdamW, Adagrad, RMSprop
      submodule.train.lr: 1e-3, 1e-4, 1e-5
      submodule.train.batch_size: 16, 32, 64
      submodule.model.hidden_size: 128, 256, 512

submodule:

  dataset:
    # Train and validate with standard datasets
    use_these_datasets: CHANGE # use the standard datasets

    # Load the smaller dataset. Won't be used for training or validation (overridden by use_this_train_dataset and use_this_val_dataset)
    experimental_datasets: Kato2015 #[Kato2015, Nichols2017, Skora2018, Uzel2022, Kaplan2020, Flavell2023, Leifer2023]
    num_named_neurons: all
    num_worms: all
    k_splits: 2
    num_train_samples: 32
    num_val_samples: 32
    seq_len: 120
    tau: 1
    smooth_data: true
    reverse: false
    use_residual: false
    

  model:
    type: NetworkLSTM
    input_size: 302
    # hidden_size: 256
    num_layers: 1
    loss: MSE
    fft_reg_param: 0.0
    l1_reg_param: 0.0
    use_this_pretrained_model: null # create fresh model

  train:
    # optimizer: AdamW
    # lr: 0.001
    epochs: 100
    save_freq: 200
    # batch_size: 16
    shuffle: true
    early_stopping:
      delta: 1e-4
      patience: 10
    lr_scheduler:
      T_0: 10
      T_mult: 2
      eta_min: 1e-5

  predict:
    worms_to_predict: [worm0]
    nb_ts_to_generate: null # time steps to generate = seq_len - context_window
    context_window: 60

  visualize:
    plot_figures_from_this_log_dir: null # plot figures of current experiment
    predict:
      worms_to_plot: null # plot all predicted worms (worm0)
      neurons_to_plot: 4 # plot all the neurons

experiment:
  name: hyp_search
  mode: MULTIRUN
  seed: 42