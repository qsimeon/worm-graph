# worm-graph
Simulating worms with graph nets


```.
├── InitialWorkingExamples
   ├── functions
   │   └── neural_interactome.py: Functions to generate activity, verbatim from Neural Interactome. We may have found discrepancy with the paper's equations here, and are completing a corrected version.
   ├── data
   │   ├── emask_default.npy: (emask * -48) is the "directionality" of each neuron (0 if excitatory or −48 mV if inhibitory), verbatim from Neural Interactome.
   │   ├── Gg_default.npy: , Gg[i,j] is the total conductivity of gap junctions between neurons i and j, verbatim from Neural Interactome.
   │   ├── Gs_default.npy: , Gs[i,j] is the total conductivity of synapses to i from j, verbatim from Neural Interactome.
   │   ├── neuron_names.txt: Names of the neurons in order, verbatim from Neural Interactome.
   │   ├── neuron_names_cleaned.txt: Names of the neurons in order, cleaned into a list.
   │   └── saved_dynamics_array.csv: Activity dynamics generated from GenerateRecordings.ipynb.
   ├── GenerateRecordings.ipynb: Generates activity dynamics randomly according to user specification, displays them.
   ├── dataset.ipynb: Generates batch dataset from 'saved_dynamics_array.csv' and connection graph, with specified adjacent timesteps to be considered for each prediction.
   ├── dataset.py: .py version of the above for loading.
   ├── LinkPredictionFromJustActivity.ipynb: Attempts to predict causal links from the dataset, displays accuracy vs ground truth.
   └── ActivityPredictionFromJustActivity.ipynb: Attempts to predict activity timeseries after a certain point, displays prediction.
 ```


# CorrectedAndSimplifiedDataGeneration

## Experiment 1: Use symbolic regression to recover equations that generated simulated C. elegans neural activity data

### Step 1: Generate simulated data

#### Short version

Run `python generate_dataset.py` from `InitialWorkingExamples/CorrectedAndSimplifiedDataGeneration` directory.

Change the `filename` parameter in the main function of `generate_dataset.py`
to change where the data are saved. 

This script will save:
1. The time series data as a npy file `{filename}.npy`
2. 2 CSVs of data, `{filename}_V_tuples.csv` and `{filename}_s_tuples.csv`,
of data formatted for input to AI Feynman

See `VisualizeSimulation.ipynb` for visualization code.

### Step 2: Perform symbolic regression

AI Feynman should have been pip installed when you created your conda environment.

To run AI Feynman on data generated by `generate_dataset.py`, open a python
REPL and run
```python
import aifeynman
aifeynman.run_aifeynman('./', 'test_s_tuples.csv_tuples.csv', 60, "14ops.txt")
```

More information on the parameters to `run_aifeynman` [here](https://github.com/SJ001/AI-Feynman).


## Experiment 2: Train a GNN (or transformer, or whatever) to model real C. elegans neural activity time-series data

This is mainly for fun since it doesn't really demonstrate anything.
But it may be useful as a component of Experiment 3.
See below.


## Experiment 3: Use symbolic regression to recover equations from real C. elegans neural activity time-series data

The first thing to try is using AI Feynman alone to do the regression for an 
equation of neural dynamics that applies to each interneuron.

If it doesn't work well, it might be because the interneurons differ from each 
other somehow.
These differences could possibly be summarized as parameters which could be fed
into AI Feynman.

To get values for such parameters, one could train a GNN (or similar model that uses
the same update rule for each neuron) governed by a small number of parameters.
It is in this scenario that the GNN from Experiment 2 could be valuable.
I'm still not sure what architecture of GNN would allow this, though.


# FAQ
- In the Neural Interactome paper, the threshold potential for each neuron is computed by imposing dVi/dt=0 and solving the equation. Why aren't there two solutions to this equation, one at the threshold and one at the resting potential?
  - A: (Most) C. Elegans neurons don't spike
- Doesn't that mean there are no interesting dynamics?
  - Kindof. You need a nonzero I_ext to get interesting dynamics (only works for some neurons). E.g. adding 2nA in tail mechanosensory neurons leads to interesting dynamics.
- Why is there a single synaptic activity variable per neuron? Shouldn't it be a different variable per synapse? Or does s_i represent the activity along the ith neuron's axon?
  - It's a simplified assumption
- What are the units of time?
  - Should be ms everywhere, but original paper author Jimin warns that there might be some specified in seconds somewhere